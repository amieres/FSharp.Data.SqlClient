      <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Beautiful Functional Architectures
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SqlCommandProvider provides statically typed access to input parameters and result set of T-SQL command in idiomatic F# way. SqlProgrammabilityProvider exposes Stored Procedures, User-Defined Types and User-Defined Functions in F# code.">
    <meta name="author" content="Dmitry Morozov, Dmitry Sevastianov">

    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet" />

    <link type="text/css" rel="stylesheet" href="./content/style.css" />
    <script type="text/javascript" src="./content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="http://fsharp.org">fsharp.org</a></li>
                <li><a href="http://fsprojects.github.io/">fsprojects</a></li>
                <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">github page</a></li>
            </ul>
            <h3 class="muted">FSharp.Data.SqlClient</h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
<h1>Beautiful Functional Architectures</h1>

<p><a href="https://projecteuler.net/problem=17">Project Euler. #17.</a></p>

<h2>F# solution:</h2>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">``1..9``</span> <span class="o">=</span> 
    [<span class="s">&quot;</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">one</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">two</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">three</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">four</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">five</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">six</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">seven</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">eight</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">nine</span><span class="s">&quot;</span>]
<span class="k">let</span> <span class="i">``10..19``</span> <span class="o">=</span>  
    [<span class="s">&quot;</span><span class="s">ten</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">eleven</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">twelve</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">thirteen</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">fourteen</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">fifteen</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">sixteen</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">seventeen</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">eighteen</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">nineteen</span><span class="s">&quot;</span>]
<span class="k">let</span> <span class="i">dozens</span> <span class="o">=</span> 
    [<span class="s">&quot;</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">twenty</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">thirty</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">forty</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">fifty</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">sixty</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">seventy</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">eighty</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">ninety</span><span class="s">&quot;</span>]

<span class="k">let</span> <span class="i">spellNumber</span> <span class="i">n</span> <span class="o">=</span> 
    [
        <span class="k">if</span> <span class="i">n</span> <span class="o">=</span> <span class="n">1000</span> <span class="k">then</span> <span class="k">yield!</span> <span class="s">&quot;</span><span class="s">onethousand</span><span class="s">&quot;</span>
        <span class="k">else</span> 
            <span class="k">let</span> <span class="i">hundredsDigit</span> <span class="o">=</span> <span class="i">n</span> <span class="o">/</span> <span class="n">100</span>
            <span class="k">if</span> <span class="i">hundredsDigit</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="k">yield!</span> <span class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">shundred</span><span class="s">&quot;</span> <span class="i">``1..9``</span><span class="o">.</span>[<span class="i">hundredsDigit</span>] 
            <span class="k">let</span> <span class="i">moduloOf100</span> <span class="o">=</span> <span class="i">n</span> <span class="o">%</span> <span class="n">100</span>
            <span class="k">if</span> <span class="i">hundredsDigit</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="i">moduloOf100</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="k">yield!</span> <span class="s">&quot;</span><span class="s">and</span><span class="s">&quot;</span>
            <span class="k">if</span> <span class="i">moduloOf100</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">10</span> <span class="o">&amp;&amp;</span> <span class="i">moduloOf100</span> <span class="o">&lt;=</span> <span class="n">19</span> <span class="k">then</span> <span class="k">yield!</span> <span class="i">``10..19``</span><span class="o">.</span>[<span class="i">moduloOf100</span> <span class="o">-</span> <span class="n">10</span>]
            <span class="k">else</span>
                <span class="k">yield!</span> <span class="i">dozens</span><span class="o">.</span>[<span class="i">moduloOf100</span> <span class="o">/</span> <span class="n">10</span>] <span class="o">+</span> <span class="i">``1..9``</span><span class="o">.</span>[<span class="i">moduloOf100</span> <span class="o">%</span> <span class="n">10</span>]
    ]

[ <span class="n">1</span> <span class="o">..</span> <span class="n">1000</span> ]
<span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">collect</span> <span class="i">spellNumber</span>
<span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">length</span></pre>
</td>
</tr>
</table>

<h2>T-SQL solution:</h2>

<p><pre lang = 'sql'>
<code>
CREATE FUNCTION dbo.SpellNumber
(
    @n AS INT
)
RETURNS @result TABLE
(
     Chars NVARCHAR(MAX) NOT NULL
)
AS
BEGIN
    IF @n = 1000
        INSERT INTO @result VALUES ('onethousand')
    ELSE
        WITH Digits AS 
        (
            SELECT offset, value
            FROM 
                (VALUES 
                    (0, ''),  (1, 'one'),  (2, 'two'),  (3, 'three'),  (4, 'four'),
                    (5, 'five'),  (6, 'six'),  (7, 'seven'),  (8, 'eight'),  (9, 'nine')) 
                AS T(offset, value)
        ),
        TenToNineteen AS
        (
            SELECT offset, value
            FROM 
                (VALUES 
                    (0, 'ten'),  (1, 'eleven'),  (2, 'twelve'),  (3, 'thirteen'),  (4, 'fourteen'),
                    (5, 'fifteen'),  (6, 'sixteen'),  (7, 'seventeen'),  (8, 'eighteen'),  (9, 'nineteen')) 
                AS T(offset, value)
        ),
        Dozens AS
        (
            SELECT offset, value
            FROM 
                (VALUES 
                    (0, ''),  (1, ''),  (2, 'twenty'),  (3, 'thirty'),  (4, 'forty'),
                    (5, 'fifty'),  (6, 'sixty'),  (7, 'seventy'),  (8, 'eighty'),  (9, 'ninety')) 
                AS T(offset, value)
        )
        INSERT INTO @result 
            SELECT value + 'hundred' FROM Digits WHERE @n / 100 > 0 AND offset = @n / 100
            UNION ALL
            SELECT 'and' WHERE @n / 100 > 0 AND @n % 100 > 0 
            UNION ALL
            SELECT value FROM TenToNineteen WHERE (@n % 100) - 10 = offset
            UNION ALL
            SELECT value FROM Dozens WHERE (@n % 100 NOT BETWEEN 10 AND 19) AND ((@n % 100) / 10 = offset) 
            UNION ALL
            SELECT value FROM Digits WHERE (@n % 100 NOT BETWEEN 10 AND 19) AND ((@n % 100) % 10 = offset) 
    RETURN
END
</code>
</pre></p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>

[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">adventureWorks</span> <span class="o">=</span> <span class="s">@&quot;</span><span class="s">Data</span><span class="s"> </span><span class="s">Source</span><span class="s">=</span><span class="s">(</span><span class="s">LocalDb</span><span class="s">)</span><span class="s">\</span><span class="s">v12</span><span class="s">.</span><span class="s">0</span><span class="s">;</span><span class="s">Initial</span><span class="s"> </span><span class="s">Catalog</span><span class="s">=</span><span class="s">AdventureWorks2012</span><span class="s">;</span><span class="s">Integrated</span><span class="s"> </span><span class="s">Security</span><span class="s">=</span><span class="s">True</span><span class="s">&quot;</span>

[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">euler17</span> <span class="o">=</span> <span class="s">&quot;</span>
<span class="s">    </span><span class="s">WITH</span><span class="s"> </span><span class="s">InfiniteSeq</span><span class="s">(</span><span class="s">N</span><span class="s">)</span><span class="s"> </span><span class="s">AS</span>
<span class="s">    </span><span class="s">(</span>
<span class="s">        </span><span class="s">SELECT</span><span class="s"> </span><span class="s">1</span>
<span class="s">	    </span><span class="s">UNION</span><span class="s"> </span><span class="s">ALL</span>
<span class="s">        </span><span class="s">SELECT</span><span class="s"> </span><span class="s">1</span><span class="s"> </span><span class="s">+</span><span class="s"> </span><span class="s">N</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">InfiniteSeq</span>
<span class="s">    </span><span class="s">)</span>

<span class="s">    </span><span class="s">SELECT</span><span class="s"> </span><span class="s">SUM</span><span class="s">(</span><span class="s">LEN</span><span class="s">(</span><span class="s">ys</span><span class="s">.</span><span class="s">Chars</span><span class="s">)</span><span class="s">)</span>
<span class="s">    </span><span class="s">FROM</span>
<span class="s">        </span><span class="s">(</span><span class="s">SELECT</span><span class="s"> </span><span class="s">TOP</span><span class="s"> </span><span class="s">1000</span><span class="s"> </span><span class="s">*</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">InfiniteSeq</span><span class="s"> </span><span class="s">)</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">xs</span>
<span class="s">	    </span><span class="s">CROSS</span><span class="s"> </span><span class="s">APPLY</span><span class="s"> </span><span class="s">dbo</span><span class="s">.</span><span class="s">SpellNumber</span><span class="s">(</span><span class="s">xs</span><span class="s">.</span><span class="s">N</span><span class="s">)</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">ys</span>
<span class="s">    </span><span class="s">OPTION</span><span class="s"> </span><span class="s">(</span><span class="s">MAXRECURSION</span><span class="s"> </span><span class="s">0</span><span class="s">)</span>
<span class="s">&quot;</span> 
<span class="k">type</span> <span class="i">Euler17</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">euler17</span>, <span class="i">adventureWorks</span>, <span class="i">SingleRow</span> <span class="o">=</span> <span class="k">true</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">Euler17</span>()
<span class="i">cmd</span><span class="o">.</span><span class="i">Execute</span>() <span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">get</span> <span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">get</span> <span class="o">|&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>


            </div>

            <div class="span3">
                <a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">
                    <img src="img/logo.png" style="width: 200px; height: 200px; margin: 10px 0px 0px 35px; border-style: none;" />
                </a>
                <ul class="nav nav-list" id="menu">
                    <li class="nav-header">F# SqlClient</li>
                    <li><a href="./index.html">Home page</a></li>
                    <li class="divider"></li>
                    <li><a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">Get Library via NuGet</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">Source Code on GitHub</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/LICENSE.md">License</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

                    <li class="nav-header">Documentation</li>
                    <li><a href="./whatsnew.html">What's New</a></li>
                    <li><a href="./netcore.html">Support for .NET Core</a></li>
                    <li><a href="./configuration and input.html">Configuration and Input</a></li>
                    <li><a href="./output.html">Output</a></li>                    
                    <li><a href="./faq.html">FAQ</a></li>
                    <li class="divider"></li>
                    <li><a href="./data modification.html">Data Modification</a></li>
                    <li><a href="./transactions.html">Transactions</a></li>
                    <li class="divider"></li>
                    <li><a href="./debugging.html">Debugging</a></li>
                    <li><a href="./unit-testing.html">Unit Testing</a></li>
                    <li class="divider"></li>
                    <li><a href="./comparison.html">Comparison</a></li>
                    <li><a href="./dynamic local db.html">Dynamic local db</a></li>
                    <li class="divider"></li>
                    <li><a href="./sqlenumprovider.quickstart.html">SqlEnumProvider</a></li>

                    <li class="nav-header">Tools</li>
                    <li><a href="http://tpetricek.github.io/FSharp.Formatting/">F# Formatting</a></li>
                    <li><a href="http://fsharp.github.io/FAKE/">FAKE</a></li>
                    <li><a href="http://fsprojects.github.io/ProjectScaffold/">F# open-source project scaffolding</a></li>
                    <li><a href="http://tomasp.net/blog/2013/great-open-source/index.html">Building great open-source libraries</a></li>
                </ul>
            </div>
        </div>
    </div>
    <a href="http://github.com/fsprojects/FSharp.Data.SqlClient">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub">
    </a>
</body>
</html>
