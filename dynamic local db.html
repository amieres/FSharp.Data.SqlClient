      <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Dynamic creation of offline MDF
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SqlCommandProvider provides statically typed access to input parameters and result set of T-SQL command in idiomatic F# way. SqlProgrammabilityProvider exposes Stored Procedures, User-Defined Types and User-Defined Functions in F# code.">
    <meta name="author" content="Dmitry Morozov, Dmitry Sevastianov">

    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet" />

    <link type="text/css" rel="stylesheet" href="./content/style.css" />
    <script type="text/javascript" src="./content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="http://fsharp.org">fsharp.org</a></li>
                <li><a href="http://fsprojects.github.io/">fsprojects</a></li>
                <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">github page</a></li>
            </ul>
            <h3 class="muted">FSharp.Data.SqlClient</h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
<h1>Dynamic creation of offline MDF</h1>

<p>Sometimes you don't want to have to be online just to compile your programs. With FSharp.Data.SqlClient you can use a local
.MDF file as the compile time connection string, and then change your connection string at runtime when you deploy your application.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>

[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">connectionString</span> <span class="o">=</span> <span class="s">@&quot;</span><span class="s">Data</span><span class="s"> </span><span class="s">Source</span><span class="s">=</span><span class="s">(</span><span class="s">LocalDB</span><span class="s">)</span><span class="s">\</span><span class="s">v12</span><span class="s">.</span><span class="s">0</span><span class="s">;</span><span class="s">AttachDbFilename</span><span class="s">=</span><span class="s">C</span><span class="s">:</span><span class="s">\</span><span class="s">git</span><span class="s">\</span><span class="s">Project1</span><span class="s">\</span><span class="s">Database1</span><span class="s">.</span><span class="s">mdf</span><span class="s">;</span><span class="s">Integrated</span><span class="s"> </span><span class="s">Security</span><span class="s">=</span><span class="s">True</span><span class="s">;</span><span class="s">Connect</span><span class="s"> </span><span class="s">Timeout</span><span class="s">=</span><span class="s">10</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<p>However, binary files like this are difficult to diff/merge when working with multiple developers. For this reason wouldn't it be nice
to store your schema in a plain text file, and have it dynamically create the MDF file for compile time?</p>

<p>Well the following scripts can do that for your project.</p>

<p>First create a file called <code>createdb.ps1</code>:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
#<span class="i">this</span> <span class="i">is</span> <span class="i">the</span> <span class="i">name</span> <span class="i">that</span> <span class="i">Fsharp</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">SqlClient</span> <span class="i">TypeProvider</span> <span class="i">expects</span> <span class="i">it</span> <span class="k">to</span> <span class="i">be</span> <span class="i">at</span> <span class="i">build</span> <span class="i">time</span>
<span class="o">$</span><span class="i">new_db_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">Database1</span><span class="s">&quot;</span> 

<span class="o">$</span><span class="i">detach_db_sql</span> <span class="o">=</span> <span class="s">@&quot;</span>
<span class="s">use</span><span class="s"> </span><span class="s">master</span><span class="s">;</span>
<span class="s">GO</span>
<span class="s">EXEC</span><span class="s"> </span><span class="s">sp_detach_db</span><span class="s"> </span><span class="s">@</span><span class="s">dbname</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">N&#39;</span><span class="s">$</span><span class="s">new_db_name&#39;</span><span class="s">;</span>
<span class="s">GO</span>
<span class="s">&quot;</span><span class="o">@</span>

<span class="o">$</span><span class="i">detach_db_sql</span> | <span class="i">Out</span><span class="o">-</span><span class="i">File</span> <span class="s">&quot;</span><span class="s">detachdb</span><span class="s">.</span><span class="s">sql</span><span class="s">&quot;</span>
<span class="i">sqlcmd</span> <span class="o">-</span><span class="i">S</span> <span class="s">&quot;</span><span class="s">(</span><span class="s">localdb</span><span class="s">)</span><span class="s">\v</span><span class="s">11</span><span class="s">.</span><span class="s">0</span><span class="s">&quot;</span> <span class="o">-</span><span class="i">i</span> <span class="i">detachdb</span><span class="o">.</span><span class="i">sql</span>
<span class="i">Remove</span><span class="o">-</span><span class="i">Item</span> <span class="o">.</span>

<span class="i">Remove</span><span class="o">-</span><span class="i">Item</span> <span class="s">&quot;</span><span class="s">$</span><span class="s">new_db_name</span><span class="s">.</span><span class="s">mdf</span><span class="s">&quot;</span>
<span class="i">Remove</span><span class="o">-</span><span class="i">Item</span> <span class="s">&quot;</span><span class="s">$</span><span class="s">new_db_name</span><span class="s">.</span><span class="s">ldf</span><span class="s">&quot;</span>

<span class="o">$</span><span class="i">create_db_sql</span> <span class="o">=</span> <span class="s">@&quot;</span>
<span class="s">    </span><span class="s">USE</span><span class="s"> </span><span class="s">master</span><span class="s"> </span><span class="s">;</span>
<span class="s">    </span><span class="s">GO</span>
<span class="s">    </span><span class="s">CREATE</span><span class="s"> </span><span class="s">DATABASE</span><span class="s"> </span><span class="s">$</span><span class="s">new_db_name</span>
<span class="s">    </span><span class="s">ON</span><span class="s"> </span>
<span class="s">    </span><span class="s">(</span><span class="s"> </span><span class="s">NAME</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">Sales_dat</span><span class="s">,</span>
<span class="s">        </span><span class="s">FILENAME</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">&#39;</span><span class="s">$</span><span class="s">PSScriptRoot</span><span class="s">\</span><span class="s">$</span><span class="s">new_db_name</span><span class="s">.</span><span class="s">mdf&#39;</span><span class="s">,</span>
<span class="s">        </span><span class="s">SIZE</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">10</span><span class="s">,</span>
<span class="s">        </span><span class="s">MAXSIZE</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">50</span><span class="s">,</span>
<span class="s">        </span><span class="s">FILEGROWTH</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">5</span><span class="s"> </span><span class="s">)</span>
<span class="s">    </span><span class="s">LOG</span><span class="s"> </span><span class="s">ON</span>
<span class="s">    </span><span class="s">(</span><span class="s"> </span><span class="s">NAME</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">Sales_log</span><span class="s">,</span>
<span class="s">        </span><span class="s">FILENAME</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">&#39;</span><span class="s">$</span><span class="s">PSScriptRoot</span><span class="s">\</span><span class="s">$</span><span class="s">new_db_name</span><span class="s">.</span><span class="s">ldf&#39;</span><span class="s">,</span>
<span class="s">        </span><span class="s">SIZE</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">5</span><span class="s">MB</span><span class="s">,</span>
<span class="s">        </span><span class="s">MAXSIZE</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">25</span><span class="s">MB</span><span class="s">,</span>
<span class="s">        </span><span class="s">FILEGROWTH</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">5</span><span class="s">MB</span><span class="s"> </span><span class="s">)</span><span class="s"> </span><span class="s">;</span>
<span class="s">    </span><span class="s">GO</span>
<span class="s">&quot;</span><span class="o">@</span>

<span class="o">$</span><span class="i">create_db_sql</span> | <span class="i">Out</span><span class="o">-</span><span class="i">File</span> <span class="s">&quot;</span><span class="s">createdb</span><span class="s">.</span><span class="s">sql</span><span class="s">&quot;</span>
<span class="i">sqlcmd</span> <span class="o">-</span><span class="i">S</span> <span class="s">&quot;</span><span class="s">(</span><span class="s">localdb</span><span class="s">)</span><span class="s">\v</span><span class="s">11</span><span class="s">.</span><span class="s">0</span><span class="s">&quot;</span> <span class="o">-</span><span class="i">i</span> <span class="i">createdb</span><span class="o">.</span><span class="i">sql</span>
<span class="i">Remove</span><span class="o">-</span><span class="i">Item</span> <span class="o">.</span>

<span class="i">sqlcmd</span> <span class="o">-</span><span class="i">S</span> <span class="s">&quot;</span><span class="s">(</span><span class="s">localdb</span><span class="s">)</span><span class="s">\v</span><span class="s">11</span><span class="s">.</span><span class="s">0</span><span class="s">&quot;</span> <span class="o">-</span><span class="i">i</span> <span class="i">schema</span><span class="o">.</span><span class="i">sql</span>

<span class="o">$</span><span class="i">detach_db_sql</span> | <span class="i">Out</span><span class="o">-</span><span class="i">File</span> <span class="s">&quot;</span><span class="s">detachdb</span><span class="s">.</span><span class="s">sql</span><span class="s">&quot;</span>
<span class="i">sqlcmd</span> <span class="o">-</span><span class="i">S</span> <span class="s">&quot;</span><span class="s">(</span><span class="s">localdb</span><span class="s">)</span><span class="s">\v</span><span class="s">11</span><span class="s">.</span><span class="s">0</span><span class="s">&quot;</span> <span class="o">-</span><span class="i">i</span> <span class="i">detachdb</span><span class="o">.</span><span class="i">sql</span>
<span class="i">Remove</span><span class="o">-</span><span class="i">Item</span> <span class="o">.</span></pre>
</td>
</tr>
</table>

<p>Then change your connection string to look like this</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">connectionStringForCompileTime</span> <span class="o">=</span> <span class="s">@&quot;</span><span class="s">Data</span><span class="s"> </span><span class="s">Source</span><span class="s">=</span><span class="s">(</span><span class="s">LocalDB</span><span class="s">)</span><span class="s">\</span><span class="s">v12</span><span class="s">.</span><span class="s">0</span><span class="s">;</span><span class="s">AttachDbFilename</span><span class="s">=</span><span class="s">&quot;</span> <span class="o">+</span> <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">@&quot;</span><span class="s">\</span><span class="s">Database1</span><span class="s">.</span><span class="s">mdf</span><span class="s">;</span><span class="s">Integrated</span><span class="s"> </span><span class="s">Security</span><span class="s">=</span><span class="s">True</span><span class="s">;</span><span class="s">Connect</span><span class="s"> </span><span class="s">Timeout</span><span class="s">=</span><span class="s">10</span><span class="s">&quot;</span>

<span class="k">type</span> <span class="i">Foo</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">*</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">Foo</span><span class="s">&quot;</span>, <span class="i">connectionStringForCompileTime</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="i">myResults</span> <span class="o">=</span> (<span class="k">new</span> <span class="i">Foo</span>(<span class="s">&quot;</span><span class="s">Use</span><span class="s"> </span><span class="s">your</span><span class="s"> </span><span class="s">Runtime</span><span class="s"> </span><span class="s">connectionString</span><span class="s"> </span><span class="s">here</span><span class="s">&quot;</span>))<span class="o">.</span><span class="i">Execute</span>()</pre>
</td>
</tr>
</table>

<p>Lastly, edit your <code>.fsproj</code> file and add the following to the very end right before <code>&lt;/Project&gt;</code></p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">&lt;</span><span class="i">Target</span> <span class="i">Name</span><span class="o">=</span><span class="s">&quot;</span><span class="s">BeforeBuild</span><span class="s">&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">Message</span> <span class="i">Text</span><span class="o">=</span><span class="s">&quot;</span><span class="s">Building</span><span class="s"> </span><span class="s">out</span><span class="s"> </span><span class="s">SQL</span><span class="s"> </span><span class="s">Database</span><span class="s">:</span><span class="s"> </span><span class="s">Database1</span><span class="s">.</span><span class="s">mdf</span><span class="s">&quot;</span> <span class="i">Importance</span><span class="o">=</span><span class="s">&quot;</span><span class="s">High</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">Exec</span> <span class="i">Command</span><span class="o">=</span><span class="s">&quot;</span><span class="s">PowerShell</span><span class="s"> </span><span class="s">-</span><span class="s">NoProfile</span><span class="s"> </span><span class="s">-</span><span class="s">ExecutionPolicy</span><span class="s"> </span><span class="s">Bypass</span><span class="s"> </span><span class="s">-</span><span class="s">Command</span><span class="s"> </span><span class="s">&amp;</span><span class="s">quot</span><span class="s">;</span><span class="s">&amp;</span><span class="s">amp</span><span class="s">;</span><span class="s"> </span><span class="s">{</span><span class="s"> </span><span class="s">$</span><span class="s">(</span><span class="s">ProjectDir</span><span class="s">)</span><span class="s">Createdb</span><span class="s">.</span><span class="s">ps1</span><span class="s"> </span><span class="s">}</span><span class="s">&amp;</span><span class="s">quot</span><span class="s">;</span><span class="s">&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="i">Target</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

<p>Now when you build, it will create a database named <code>Database1</code> and then look for a file called <code>schema.sql</code> which will be used
to create the database.  It will then compile against this dynamically generated MDF file so you'll get full static type checking
without the hassle of having to have an internet connection, or deal with binary .MDF files!</p>


            </div>

            <div class="span3">
                <a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">
                    <img src="img/logo.png" style="width: 200px; height: 200px; margin: 10px 0px 0px 35px; border-style: none;" />
                </a>
                <ul class="nav nav-list" id="menu">
                    <li class="nav-header">F# SqlClient</li>
                    <li><a href="./index.html">Home page</a></li>
                    <li class="divider"></li>
                    <li><a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">Get Library via NuGet</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">Source Code on GitHub</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/LICENSE.md">License</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

                    <li class="nav-header">Documentation</li>
                    <li><a href="./whatsnew.html">What's New</a></li>
                    <li><a href="./configuration and input.html">Configuration and Input</a></li>
                    <li><a href="./output.html">Output</a></li>
                    <li><a href="./faq.html">FAQ</a></li>
                    <li class="divider"></li>
                    <li><a href="./data modification.html">Data Modification</a></li>
                    <li><a href="./transactions.html">Transactions</a></li>
                    <li class="divider"></li>
                    <li><a href="./debugging.html">Debugging</a></li>
                    <li><a href="./unit-testing.html">Unit Testing</a></li>
                    <li class="divider"></li>
                    <li><a href="./comparison.html">Comparison</a></li>
                    <li><a href="./dynamic local db.html">Dynamic local db</a></li>
                    <li class="divider"></li>
                    <li><a href="./sqlenumprovider.quickstart.html">SqlEnumProvider</a></li>

                    <li class="nav-header">Tools</li>
                    <li><a href="http://tpetricek.github.io/FSharp.Formatting/">F# Formatting</a></li>
                    <li><a href="http://fsharp.github.io/FAKE/">FAKE</a></li>
                    <li><a href="http://fsprojects.github.io/ProjectScaffold/">F# open-source project scaffolding</a></li>
                    <li><a href="http://tomasp.net/blog/2013/great-open-source/index.html">Building great open-source libraries</a></li>
                </ul>
            </div>
        </div>
    </div>
    <a href="http://github.com/fsprojects/FSharp.Data.SqlClient">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub">
    </a>
</body>
</html>
