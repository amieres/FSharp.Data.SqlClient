      <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Controlling output
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SqlCommandProvider provides statically typed access to input parameters and result set of T-SQL command in idiomatic F# way. SqlProgrammabilityProvider exposes Stored Procedures, User-Defined Types and User-Defined Functions in F# code.">
    <meta name="author" content="Dmitry Morozov, Dmitry Sevastianov">

    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet" />

    <link type="text/css" rel="stylesheet" href="./content/style.css" />
    <script type="text/javascript" src="./content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="http://fsharp.org">fsharp.org</a></li>
                <li><a href="http://fsprojects.github.io/">fsprojects</a></li>
                <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">github page</a></li>
            </ul>
            <h3 class="muted">FSharp.Data.SqlClient</h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
<h1>Controlling output</h1>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">//Connection and query definition are shared for most of the examples below</span>

[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">productsSql</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s"> </span>
<span class="s">    </span><span class="s">SELECT</span><span class="s"> </span><span class="s">TOP</span><span class="s"> </span><span class="s">(</span><span class="s">@</span><span class="s">top</span><span class="s">)</span><span class="s"> </span><span class="s">Name</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">ProductName</span><span class="s">,</span><span class="s"> </span><span class="s">SellStartDate</span><span class="s">,</span><span class="s"> </span><span class="s">Size</span>
<span class="s">    </span><span class="s">FROM</span><span class="s"> </span><span class="s">Production</span><span class="s">.</span><span class="s">Product</span><span class="s"> </span>
<span class="s">    </span><span class="s">WHERE</span><span class="s"> </span><span class="s">SellStartDate</span><span class="s"> </span><span class="s">&gt;</span><span class="s"> </span><span class="s">@</span><span class="s">SellStartDate</span>
<span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<ul>
<li>Sequence of custom records is default result set type.</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">QueryProductAsRecords</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">productsSql</span>, <span class="i">connectionString</span><span class="o">&gt;</span>
<span class="k">let</span> <span class="i">queryProductAsRecords</span> <span class="o">=</span> <span class="k">new</span> <span class="i">QueryProductAsRecords</span>(<span class="i">connectionString</span>)

<span class="k">let</span> <span class="i">records</span> <span class="o">=</span> 
    <span class="i">queryProductAsRecords</span><span class="o">.</span><span class="i">AsyncExecute</span>(<span class="i">top</span> <span class="o">=</span> <span class="n">7L</span>, <span class="i">SellStartDate</span> <span class="o">=</span> <span class="i">System</span><span class="o">.</span><span class="i">DateTime</span><span class="o">.</span><span class="i">Parse</span> <span class="s">&quot;</span><span class="s">2002</span><span class="s">-</span><span class="s">06</span><span class="s">-</span><span class="s">01</span><span class="s">&quot;</span>)
    <span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">RunSynchronously</span> 
    <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">ofSeq</span>

<span class="i">records</span> <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">iter</span> (<span class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span>)</pre>
</td>
</tr>
</table>

<p>These records implement <code>DynamicObject</code> for easy binding and JSON.NET serialization and <code>Equals</code> for structural equality.</p>

<ul>
<li>Sync execution</li>
<li>Seq of tuples as result set type</li>
<li>Consider ResultType.Tuples to work around unique column name limitation for ResultType.Records.</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">QueryProductSync</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">productsSql</span>, <span class="i">connectionString</span>, <span class="i">ResultType</span> <span class="o">=</span> <span class="i">ResultType</span><span class="o">.</span><span class="i">Tuples</span><span class="o">&gt;</span>

<span class="k">do</span>
    <span class="k">use</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">QueryProductSync</span>(<span class="i">connectionString</span>)
    <span class="k">let</span> <span class="i">tuples</span> <span class="o">=</span> <span class="i">cmd</span><span class="o">.</span><span class="i">Execute</span>(<span class="i">top</span> <span class="o">=</span> <span class="n">7L</span>, <span class="i">SellStartDate</span> <span class="o">=</span> <span class="i">System</span><span class="o">.</span><span class="i">DateTime</span><span class="o">.</span><span class="i">Parse</span> <span class="s">&quot;</span><span class="s">2002</span><span class="s">-</span><span class="s">06</span><span class="s">-</span><span class="s">01</span><span class="s">&quot;</span>) 

    <span class="k">for</span> <span class="i">productName</span>, <span class="i">sellStartDate</span>, <span class="i">size</span> <span class="k">in</span> <span class="i">tuples</span> <span class="k">do</span>
        <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Product</span><span class="s"> </span><span class="s">name</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">.</span><span class="s"> </span><span class="s">Sells</span><span class="s"> </span><span class="s">start</span><span class="s"> </span><span class="s">date</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">,</span><span class="s"> </span><span class="s">size</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span class="i">productName</span> <span class="i">sellStartDate</span> <span class="i">size</span></pre>
</td>
</tr>
</table>

<ul>
<li>Typed data table as result set</li>
<li>DataTable result type is an enabler for data binding and update scenarios. Look at <a href="data modification.html">data modification</a> for details.</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">do</span> 
    <span class="k">use</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">productsSql</span>, <span class="i">connectionString</span>, <span class="i">ResultType</span><span class="o">.</span><span class="i">DataTable</span><span class="o">&gt;</span>(<span class="i">connectionString</span>)
    <span class="k">let</span> <span class="i">table</span> <span class="o">=</span> <span class="i">cmd</span><span class="o">.</span><span class="i">Execute</span>(<span class="i">top</span> <span class="o">=</span> <span class="n">7L</span>, <span class="i">SellStartDate</span> <span class="o">=</span> <span class="i">System</span><span class="o">.</span><span class="i">DateTime</span><span class="o">.</span><span class="i">Parse</span> <span class="s">&quot;</span><span class="s">2002</span><span class="s">-</span><span class="s">06</span><span class="s">-</span><span class="s">01</span><span class="s">&quot;</span>) 
    <span class="k">for</span> <span class="i">row</span> <span class="k">in</span> <span class="i">table</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
        <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Product</span><span class="s"> </span><span class="s">name</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">.</span><span class="s"> </span><span class="s">Sells</span><span class="s"> </span><span class="s">start</span><span class="s"> </span><span class="s">date</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">,</span><span class="s"> </span><span class="s">size</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span class="i">row</span><span class="o">.</span><span class="i">ProductName</span> <span class="i">row</span><span class="o">.</span><span class="i">SellStartDate</span> <span class="i">row</span><span class="o">.</span><span class="i">Size</span></pre>
</td>
</tr>
</table>

<ul>
<li>Single row hint. Must be provided explicitly. Cannot be inferred</li>
<li>Nullable columns mapped to <code>Option&lt;_&gt;</code> type</li>
<li>Calling SQL Table-Valued Function</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">QueryPersonInfoSingletoneAsRecords</span> <span class="o">=</span> 
    <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">*</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">dbo</span><span class="s">.</span><span class="s">ufnGetContactInformation</span><span class="s">(</span><span class="s">@</span><span class="s">PersonId</span><span class="s">)</span><span class="s">&quot;</span>
                        , <span class="i">connectionString</span>
                        , <span class="i">SingleRow</span> <span class="o">=</span> <span class="k">true</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="i">singleton</span> <span class="o">=</span> <span class="k">new</span> <span class="i">QueryPersonInfoSingletoneAsRecords</span>(<span class="i">connectionString</span>)

<span class="k">let</span> <span class="i">person</span> <span class="o">=</span> <span class="i">singleton</span><span class="o">.</span><span class="i">AsyncExecute</span>(<span class="i">PersonId</span> <span class="o">=</span> <span class="n">2</span>) <span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">RunSynchronously</span> <span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">get</span>
<span class="k">match</span> <span class="i">person</span><span class="o">.</span><span class="i">FirstName</span>, <span class="i">person</span><span class="o">.</span><span class="i">LastName</span> <span class="k">with</span>
| <span class="i">Some</span> <span class="i">first</span>, <span class="i">Some</span> <span class="i">last</span> <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Person</span><span class="s"> </span><span class="s">id</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">,</span><span class="s"> </span><span class="s">name</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">person</span><span class="o">.</span><span class="i">PersonID</span> <span class="i">first</span> <span class="i">last</span> 
| _ <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">What&#39;s</span><span class="s"> </span><span class="s">your</span><span class="s"> </span><span class="s">name</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">?</span><span class="s">&quot;</span> <span class="i">person</span><span class="o">.</span><span class="i">PersonID</span></pre>
</td>
</tr>
</table>

<ul>
<li>Same as previous but using tuples as result type</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">queryPersonInfoSingletoneQuery</span> <span class="o">=</span> 
    <span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">PersonID</span><span class="s">,</span><span class="s"> </span><span class="s">FirstName</span><span class="s">,</span><span class="s"> </span><span class="s">LastName</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">dbo</span><span class="s">.</span><span class="s">ufnGetContactInformation</span><span class="s">(</span><span class="s">@</span><span class="s">PersonId</span><span class="s">)</span><span class="s">&quot;</span>

<span class="k">type</span> <span class="i">QueryPersonInfoSingletoneTuples</span> <span class="o">=</span> 
    <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">queryPersonInfoSingletoneQuery</span>, <span class="i">connectionString</span>, <span class="i">ResultType</span><span class="o">.</span><span class="i">Tuples</span>, <span class="i">SingleRow</span><span class="o">=</span><span class="k">true</span><span class="o">&gt;</span>

<span class="i">QueryPersonInfoSingletoneTuples</span>
    <span class="o">.</span><span class="i">Create</span>(<span class="i">connectionString</span>)
    <span class="o">.</span><span class="i">Execute</span>(<span class="i">PersonId</span> <span class="o">=</span> <span class="n">2</span>)<span class="o">.</span><span class="i">Value</span>
    <span class="o">|&gt;</span> (<span class="k">function</span>
        | <span class="i">id</span>, <span class="i">Some</span> <span class="i">first</span>, <span class="i">Some</span> <span class="i">last</span> <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Person</span><span class="s"> </span><span class="s">id</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">,</span><span class="s"> </span><span class="s">name</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">person</span><span class="o">.</span><span class="i">PersonID</span> <span class="i">first</span> <span class="i">last</span> 
        | <span class="i">id</span>, _, _ <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">What&#39;s</span><span class="s"> </span><span class="s">your</span><span class="s"> </span><span class="s">name</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">?</span><span class="s">&quot;</span> <span class="i">person</span><span class="o">.</span><span class="i">PersonID</span>
    ) </pre>
</td>
</tr>
</table>

<ul>
<li>Same as previous but using typed DataTable as result type</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">QueryPersonInfoSingletoneDataTable</span> <span class="o">=</span> 
    <span class="i">SqlCommandProvider</span><span class="o">&lt;</span>
        <span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">*</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">dbo</span><span class="s">.</span><span class="s">ufnGetContactInformation</span><span class="s">(</span><span class="s">@</span><span class="s">PersonId</span><span class="s">)</span><span class="s">&quot;</span>, 
        <span class="i">connectionString</span>, 
        <span class="i">ResultType</span> <span class="o">=</span> <span class="i">ResultType</span><span class="o">.</span><span class="i">DataTable</span><span class="o">&gt;</span>

<span class="k">do</span> 
    <span class="k">use</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">QueryPersonInfoSingletoneDataTable</span>(<span class="i">connectionString</span>)
    <span class="k">let</span> <span class="i">table</span> <span class="o">=</span> <span class="i">cmd</span> <span class="o">.</span><span class="i">AsyncExecute</span>(<span class="i">PersonId</span> <span class="o">=</span> <span class="n">2</span>) <span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">RunSynchronously</span> 
    <span class="k">for</span> <span class="i">row</span> <span class="k">in</span> <span class="i">table</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
        <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Person</span><span class="s"> </span><span class="s">info</span><span class="s">:</span><span class="s">Id</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">,</span><span class="s">FirstName</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">,</span><span class="s">LastName</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">&quot;</span> <span class="i">row</span><span class="o">.</span><span class="i">PersonID</span> <span class="i">row</span><span class="o">.</span><span class="i">FirstName</span> <span class="i">row</span><span class="o">.</span><span class="i">LastName</span> 

<span class="c">// you can refer to the table type</span>
<span class="k">let</span> <span class="i">table2</span> <span class="o">:</span> <span class="i">QueryPersonInfoSingletoneDataTable</span><span class="o">.</span><span class="i">Table</span> <span class="o">=</span> 
    <span class="k">let</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">QueryPersonInfoSingletoneDataTable</span>(<span class="i">connectionString</span>)
    <span class="i">cmd</span><span class="o">.</span><span class="i">Execute</span>(<span class="i">PersonId</span> <span class="o">=</span> <span class="n">2</span>)

<span class="c">// you can refer to the row type</span>
<span class="k">for</span> <span class="i">row</span> <span class="o">:</span> <span class="i">QueryPersonInfoSingletoneDataTable</span><span class="o">.</span><span class="i">Table</span><span class="o">.</span><span class="i">Row</span> <span class="k">in</span> <span class="i">table2</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
    <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Person</span><span class="s"> </span><span class="s">info</span><span class="s">:</span><span class="s">Id</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">,</span><span class="s">FirstName</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">,</span><span class="s">LastName</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">&quot;</span> <span class="i">row</span><span class="o">.</span><span class="i">PersonID</span> <span class="i">row</span><span class="o">.</span><span class="i">FirstName</span> <span class="i">row</span><span class="o">.</span><span class="i">LastName</span> </pre>
</td>
</tr>
</table>

<ul>
<li>Same as previous but using <code>SqlProgrammabilityProvider&lt;...&gt;</code></li>
<li>Worth noting that Stored Procedure/Function generated command instances have explicit ExecuteSingle/ AsyncExecuteSingle methods because there is no single place to specify SingleRow=true as for SqlCommandProvider.</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">AdventureWorks2012</span> <span class="o">=</span> <span class="i">SqlProgrammabilityProvider</span><span class="o">&lt;</span><span class="i">connectionString</span><span class="o">&gt;</span>
<span class="k">do</span>
    <span class="k">use</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">AdventureWorks2012</span><span class="o">.</span><span class="i">dbo</span><span class="o">.</span><span class="i">ufnGetContactInformation</span>(<span class="i">connectionString</span>)
    <span class="i">cmd</span><span class="o">.</span><span class="i">ExecuteSingle</span>(<span class="n">1</span>) <span class="c">//opt-in for explicit call to </span>
    <span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">iter</span>(<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span>  
        <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Person</span><span class="s"> </span><span class="s">info</span><span class="s">:</span><span class="s">Id</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">,</span><span class="s">FirstName</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">,</span><span class="s">LastName</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">&quot;</span> <span class="i">x</span><span class="o">.</span><span class="i">PersonID</span> <span class="i">x</span><span class="o">.</span><span class="i">FirstName</span> <span class="i">x</span><span class="o">.</span><span class="i">LastName</span> 
    )</pre>
</td>
</tr>
</table>

<ul>
<li>One column only result set is inferred. Combined with <code>SingleRow</code> hint it gives single value as result</li>
<li><code>AsyncExecute/Execute</code> are just regular F# methods, so args can be passed by name or by position</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">QueryPersonInfoSingleValue</span> <span class="o">=</span> 
    <span class="i">SqlCommandProvider</span><span class="o">&lt;</span>
        <span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">FirstName</span><span class="s"> </span><span class="s">+</span><span class="s"> </span><span class="s">&#39;</span><span class="s"> </span><span class="s">&#39;</span><span class="s">  </span><span class="s">+</span><span class="s"> </span><span class="s">LastName</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">dbo</span><span class="s">.</span><span class="s">ufnGetContactInformation</span><span class="s">(</span><span class="s">@</span><span class="s">PersonId</span><span class="s">)</span><span class="s">&quot;</span>, 
        <span class="i">connectionString</span>, 
        <span class="i">SingleRow</span><span class="o">=</span><span class="k">true</span><span class="o">&gt;</span>

<span class="k">do</span> 
    <span class="k">let</span> <span class="i">personId</span> <span class="o">=</span> <span class="n">2</span>
    <span class="k">use</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">QueryPersonInfoSingleValue</span>(<span class="i">connectionString</span>)
    <span class="i">cmd</span><span class="o">.</span><span class="i">Execute</span>( <span class="i">personId</span>)
    <span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">iter</span> (<span class="k">fun</span> <span class="i">name</span> <span class="k">-&gt;</span> <span class="i">printf</span> <span class="s">&quot;</span><span class="s">Person</span><span class="s"> </span><span class="s">with</span><span class="s"> </span><span class="s">id</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s"> </span><span class="s">has</span><span class="s"> </span><span class="s">name</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">personId</span> <span class="i">name</span><span class="o">.</span><span class="i">Value</span>)</pre>
</td>
</tr>
</table>

<ul>
<li>Single value</li>
<li>Running the same command more than once with diff params</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">GetServerTime</span> <span class="o">=</span> 
    <span class="i">SqlCommandProvider</span><span class="o">&lt;</span>
        <span class="s">&quot;</span><span class="s">IF</span><span class="s"> </span><span class="s">@</span><span class="s">IsUtc</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">CAST</span><span class="s">(</span><span class="s">1</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">BIT</span><span class="s">)</span><span class="s"> </span><span class="s">SELECT</span><span class="s"> </span><span class="s">GETUTCDATE</span><span class="s">(</span><span class="s">)</span><span class="s"> </span><span class="s">ELSE</span><span class="s"> </span><span class="s">SELECT</span><span class="s"> </span><span class="s">GETDATE</span><span class="s">(</span><span class="s">)</span><span class="s">&quot;</span>, 
        <span class="i">connectionString</span>, 
        <span class="i">SingleRow</span><span class="o">=</span><span class="k">true</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="i">getSrvTime</span> <span class="o">=</span> <span class="k">new</span> <span class="i">GetServerTime</span>(<span class="i">connectionString</span>)

<span class="i">getSrvTime</span><span class="o">.</span><span class="i">AsyncExecute</span>(<span class="i">IsUtc</span> <span class="o">=</span> <span class="k">true</span>) <span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">RunSynchronously</span> <span class="o">|&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span>
<span class="i">getSrvTime</span><span class="o">.</span><span class="i">Execute</span>(<span class="i">IsUtc</span> <span class="o">=</span> <span class="k">false</span>) <span class="o">|&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<ul>
<li>Non-query</li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">invokeSp</span> <span class="o">=</span> <span class="s">&quot;</span>
<span class="s">    </span><span class="s">EXEC</span><span class="s"> </span><span class="s">HumanResources</span><span class="s">.</span><span class="s">uspUpdateEmployeePersonalInfo</span><span class="s"> </span>
<span class="s">        </span><span class="s">@</span><span class="s">BusinessEntityID</span><span class="s">,</span><span class="s"> </span>
<span class="s">        </span><span class="s">@</span><span class="s">NationalIDNumber</span><span class="s">,</span>
<span class="s">        </span><span class="s">@</span><span class="s">BirthDate</span><span class="s">,</span><span class="s"> </span>
<span class="s">        </span><span class="s">@</span><span class="s">MaritalStatus</span><span class="s">,</span><span class="s"> </span>
<span class="s">        </span><span class="s">@</span><span class="s">Gender</span>
<span class="s">&quot;</span>
<span class="k">type</span> <span class="i">UpdateEmplInfoCommand</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">invokeSp</span>, <span class="i">connectionString</span><span class="o">&gt;</span>
<span class="k">let</span> <span class="i">nonQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="i">UpdateEmplInfoCommand</span>(<span class="i">connectionString</span>)
<span class="k">let</span> <span class="i">rowsAffected</span> <span class="o">=</span> 
    <span class="i">nonQuery</span><span class="o">.</span><span class="i">Execute</span>(
        <span class="i">BusinessEntityID</span> <span class="o">=</span> <span class="n">2</span>, <span class="i">NationalIDNumber</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">245797967</span><span class="s">&quot;</span>, 
        <span class="i">BirthDate</span> <span class="o">=</span> <span class="i">System</span><span class="o">.</span><span class="i">DateTime</span>(<span class="n">1965</span>, <span class="n">09</span>, <span class="n">01</span>), <span class="i">MaritalStatus</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">S</span><span class="s">&quot;</span>, <span class="i">Gender</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">F</span><span class="s">&quot;</span>) </pre>
</td>
</tr>
</table>

<ul>
<li>Non-query with MS SQL HierarchyId using <code>SqlProgrammabilityProvider&lt;...&gt;</code></li>
</ul>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span class="i">System</span>
<span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Data</span>
<span class="k">open</span> <span class="i">Microsoft</span><span class="o">.</span><span class="i">SqlServer</span><span class="o">.</span><span class="i">Types</span>

<span class="k">do</span> 
    <span class="k">use</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">AdventureWorks2012</span><span class="o">.</span><span class="i">HumanResources</span><span class="o">.</span><span class="i">uspUpdateEmployeeLogin</span>(<span class="i">connectionString</span>)
    <span class="k">let</span> <span class="i">hierarchyId</span> <span class="o">=</span> <span class="i">SqlHierarchyId</span><span class="o">.</span><span class="i">Parse</span>(<span class="i">SqlTypes</span><span class="o">.</span><span class="i">SqlString</span>(<span class="s">&quot;</span><span class="s">/</span><span class="s">1</span><span class="s">/</span><span class="s">4</span><span class="s">/</span><span class="s">2</span><span class="s">/</span><span class="s">&quot;</span>))
    <span class="i">cmd</span><span class="o">.</span><span class="i">Execute</span>(
        <span class="i">BusinessEntityID</span> <span class="o">=</span> <span class="n">291</span>, 
        <span class="i">CurrentFlag</span> <span class="o">=</span> <span class="k">true</span>, 
        <span class="i">HireDate</span> <span class="o">=</span> <span class="i">DateTime</span>(<span class="n">2013</span>,<span class="n">1</span>,<span class="n">1</span>), 
        <span class="i">JobTitle</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">gatekeeper</span><span class="s">&quot;</span>, 
        <span class="i">LoginID</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">adventure</span><span class="s">-</span><span class="s">works</span><span class="s">\</span><span class="s">gat0</span><span class="s">&quot;</span>, 
        <span class="i">OrganizationNode</span> <span class="o">=</span> <span class="i">hierarchyId</span>
    )
    <span class="o">|&gt;</span> <span class="i">printfn</span> <span class="s">&quot;</span><span class="s">Records</span><span class="s"> </span><span class="s">afftected</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<h3>Result sequence is un-buffered by default</h3>

<p>Although it implements standard <code>seq&lt;_&gt;</code> (<code>IEnumerable&lt;_&gt;</code>) interface it can be evaluated only once. 
It is done mostly for memory efficiency. It behaves as forward-only cursor similar to underlying SqlDataReader. 
If multiple passes over the sequence required use standard <code>Seq.cache</code> combinator.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">Get42</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">*</span><span class="s"> </span><span class="s">FROM</span><span class="s"> </span><span class="s">(</span><span class="s">VALUES</span><span class="s"> </span><span class="s">(</span><span class="s">42</span><span class="s">)</span><span class="s">,</span><span class="s"> </span><span class="s">(</span><span class="s">43</span><span class="s">)</span><span class="s">)</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">T</span><span class="s">(</span><span class="s">N</span><span class="s">)</span><span class="s">&quot;</span>, <span class="i">connectionString</span><span class="o">&gt;</span>
<span class="k">let</span> <span class="i">xs</span> <span class="o">=</span> (<span class="k">new</span> <span class="i">Get42</span>(<span class="i">connectionString</span>))<span class="o">.</span><span class="i">Execute</span>() <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">cache</span> 
<span class="i">printfn</span> <span class="s">&quot;</span><span class="s">#</span><span class="s">1</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s"> </span><span class="s">&quot;</span> <span class="o">&lt;|</span> <span class="i">Seq</span><span class="o">.</span><span class="i">nth</span> <span class="n">0</span> <span class="i">xs</span> 
<span class="i">printfn</span> <span class="s">&quot;</span><span class="s">#</span><span class="s">2</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s"> </span><span class="s">&quot;</span> <span class="o">&lt;|</span> <span class="i">Seq</span><span class="o">.</span><span class="i">nth</span> <span class="n">1</span> <span class="i">xs</span> <span class="c">//see it fails here if result is not piped into Seq.cache </span></pre>
</td>
</tr>
</table>

<h3>Output result types summary:</h3>

<ul>
<li>Records (default) .NET-style class with read-only properties. WebAPI/ASP.NET MVC/Json.NET/WPF, Data Binding</li>
<li>Tuples - convenient option for F# combined with pattern matching</li>
<li>DataTable with inferred data rows similar to Records. Update scenarios. WPF data binding</li>
<li>DataReader - for rare cases when structure of output cannot be inferred</li>
</ul>

<p>In later case, resulting <code>SqlDataReader</code> can be wrapped into something like that:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span class="i">SqlDataReader</span> <span class="o">=</span>  
    <span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">SqlClient</span>
    <span class="k">let</span> <span class="i">toMaps</span> (<span class="i">reader</span><span class="o">:</span> <span class="i">SqlDataReader</span>) <span class="o">=</span> 
        <span class="i">seq</span> {
            <span class="k">use</span> <span class="i">__</span> <span class="o">=</span> <span class="i">reader</span>
            <span class="k">while</span> <span class="i">reader</span><span class="o">.</span><span class="i">Read</span>() <span class="k">do</span>
                <span class="k">yield</span> [
                    <span class="k">for</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span class="i">reader</span><span class="o">.</span><span class="i">FieldCount</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span>
                        <span class="k">if</span> <span class="i">not</span>( <span class="i">reader</span><span class="o">.</span><span class="i">IsDBNull</span>(<span class="i">i</span>)) 
                        <span class="k">then</span> <span class="k">yield</span> <span class="i">reader</span><span class="o">.</span><span class="i">GetName</span>(<span class="i">i</span>), <span class="i">reader</span><span class="o">.</span><span class="i">GetValue</span>(<span class="i">i</span>)
                ] <span class="o">|&gt;</span> <span class="i">Map</span><span class="o">.</span><span class="i">ofList</span> 
        }</pre>
</td>
</tr>
</table>

<p>Note that combined with <code>|&gt; Map.tryFind(key)</code> this approach can be used to achieve <code>Option</code> semantics 
for each row, in other words, such function will return <code>None</code> for <code>NULL</code> values. Keep in mind though that
the incorrect column name will also return <code>None</code>.
The same approach can be used to produce <code>ExpandoObject</code> for dynamic scenarios.</p>


            </div>

            <div class="span3">
                <a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">
                    <img src="img/logo.png" style="width: 200px; height: 200px; margin: 10px 0px 0px 35px; border-style: none;" />
                </a>
                <ul class="nav nav-list" id="menu">
                    <li class="nav-header">F# SqlClient</li>
                    <li><a href="./index.html">Home page</a></li>
                    <li class="divider"></li>
                    <li><a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">Get Library via NuGet</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">Source Code on GitHub</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/LICENSE.md">License</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

                    <li class="nav-header">Documentation</li>
                    <li><a href="./whatsnew.html">What's New</a></li>
                    <li><a href="./netcore.html">Support for .NET Core</a></li>
                    <li><a href="./configuration and input.html">Configuration and Input</a></li>
                    <li><a href="./output.html">Output</a></li>                    
                    <li><a href="./faq.html">FAQ</a></li>
                    <li class="divider"></li>
                    <li><a href="./data modification.html">Data Modification</a></li>
                    <li><a href="./transactions.html">Transactions</a></li>
                    <li class="divider"></li>
                    <li><a href="./debugging.html">Debugging</a></li>
                    <li><a href="./unit-testing.html">Unit Testing</a></li>
                    <li class="divider"></li>
                    <li><a href="./comparison.html">Comparison</a></li>
                    <li><a href="./dynamic local db.html">Dynamic local db</a></li>
                    <li class="divider"></li>
                    <li><a href="./sqlenumprovider.quickstart.html">SqlEnumProvider</a></li>

                    <li class="nav-header">Tools</li>
                    <li><a href="http://tpetricek.github.io/FSharp.Formatting/">F# Formatting</a></li>
                    <li><a href="http://fsharp.github.io/FAKE/">FAKE</a></li>
                    <li><a href="http://fsprojects.github.io/ProjectScaffold/">F# open-source project scaffolding</a></li>
                    <li><a href="http://tomasp.net/blog/2013/great-open-source/index.html">Building great open-source libraries</a></li>
                </ul>
            </div>
        </div>
    </div>
    <a href="http://github.com/fsprojects/FSharp.Data.SqlClient">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub">
    </a>
</body>
</html>
