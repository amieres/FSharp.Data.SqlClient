      <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAQ
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SqlCommandProvider provides statically typed access to input parameters and result set of T-SQL command in idiomatic F# way. SqlProgrammabilityProvider exposes Stored Procedures, User-Defined Types and User-Defined Functions in F# code.">
    <meta name="author" content="Dmitry Morozov, Dmitry Sevastianov">

    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet" />

    <link type="text/css" rel="stylesheet" href="./content/style.css" />
    <script type="text/javascript" src="./content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="http://fsharp.org">fsharp.org</a></li>
                <li><a href="http://fsprojects.github.io/">fsprojects</a></li>
                <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">github page</a></li>
            </ul>
            <h3 class="muted">FSharp.Data.SqlClient</h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
<h1>FAQ</h1>

<h3>1. How do I specify default value for a parameter?</h3>

<p><code>SqlCommandProvider</code> generates parameters for all unbound T-SQL script variables. 
By definition those variables don't have default value. 
One workaround is to assume NULL as default value (see next item).
The other option is to have default value logic in application code.</p>

<p>If you feel strongly about having default parameter values defined in T-SQL 
consider wrapping it into stored procedure or function. Both accept default values for parameters. 
<code>SqlProgrammabilityProvider</code> supports this scenario by mapping it to .NET method parameters with default values.</p>

<h3>2. How do I pass NULL as parameter value?</h3>

<p>By default SqlCommandProvider treat all parameters as mandatory.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">echoOnly</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">ISNULL</span><span class="s">(</span><span class="s">@</span><span class="s">x</span><span class="s">,</span><span class="s"> </span><span class="s">42</span><span class="s">)</span><span class="s">&quot;</span>, <span class="i">connectionString</span>, <span class="i">SingleRow</span> <span class="o">=</span> <span class="k">true</span><span class="o">&gt;</span>(<span class="i">connectionString</span>)
<span class="i">echoOnly</span><span class="o">.</span><span class="i">Execute</span>( <span class="i">x</span> <span class="o">=</span> <span class="c">(* must pass int value here *)</span> <span class="n">1</span>) </pre>
</td>
</tr>
</table>

<p>There is no way to pass NULL as value for parameter <code>@x</code> although the query knows how to handle it.</p>

<p>To resolve the issue specify <code>AllParametersOptional = true</code> as static parameter to type provider. 
It makes all parameters of type <code>option&lt;_&gt;</code> with default value <code>None</code>.</p>

<div class="well well-small" style="margin:0px 70px 0px 20px;">

<p><strong>Note</strong> This is not same as F# optional parameters<em></em> but mimics them closely.
Unfortunately type providers in general restricted to emit .NET 1.1 types only. 
No generics, no F# specific types/annotations which includes optional parameters.</p>

</p></div>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">echoOr42</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="s">&quot;</span>
<span class="s">        </span><span class="s">SELECT</span><span class="s"> </span><span class="s">ISNULL</span><span class="s">(</span><span class="s">@</span><span class="s">x</span><span class="s">,</span><span class="s"> </span><span class="s">42</span><span class="s">)</span>
<span class="s">    </span><span class="s">&quot;</span>, <span class="i">connectionString</span>, <span class="i">SingleRow</span> <span class="o">=</span> <span class="k">true</span>, <span class="i">AllParametersOptional</span> <span class="o">=</span> <span class="k">true</span><span class="o">&gt;</span>(<span class="i">connectionString</span>)

<span class="c">// Pass parameter value. Specifying Some constructor is mandatrory.</span>
<span class="i">echoOr42</span><span class="o">.</span><span class="i">Execute</span>( <span class="i">Some</span> <span class="n">1</span>) 

<span class="c">// Pass NULL by omitting parameter</span>
<span class="i">echoOr42</span><span class="o">.</span><span class="i">Execute</span>() 

<span class="c">//Pass NULL explicitly</span>
<span class="i">echoOr42</span><span class="o">.</span><span class="i">Execute</span>( <span class="i">x</span> <span class="o">=</span> <span class="i">None</span>) </pre>
</td>
</tr>
</table>

<h3>3. How do I do dynamic filter?</h3>

<p>Dynamic filters is when your T-SQL command accepts multiple input arguments and is supposed 
to determine which columns to filter, if at all, based on that input.</p>

<p>Following command allows to filter dynamically information on sales people based on country and minimal sales amount.</p>

<h3>4. Why do I get compile time error " ... The undeclared parameter '@p1' is used more than once in the batch being analyzed."?</h3>

<p>This is a limitation of <a href="https://msdn.microsoft.com/en-us/library/ff878260.aspx">sys.sp_describe_undeclared_parameters</a>.</p>

<p>To work around this limitation, you can declare another variable in your script:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// this one would fail with above mentionned error:</span>
<span class="c">//let echoFail = </span>
<span class="c">//    new SqlCommandProvider&lt;&quot;</span>
<span class="c">//        select &#39;hello&#39; + @name, &#39;your name is :&#39; @name</span>
<span class="c">//    &quot;, connectionString, SingleRow = true&gt;(connectionString)</span>

<span class="c">// this one is ok as @name parameter is used only once in the statement:</span>
<span class="k">let</span> <span class="i">echoOk</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span> <span class="s">@&quot;</span>
<span class="s">        </span><span class="s">declare</span><span class="s"> </span><span class="s">@</span><span class="s">theName</span><span class="s"> </span><span class="s">nvarchar</span><span class="s">(</span><span class="s">max</span><span class="s">)</span>
<span class="s">        </span><span class="s">set</span><span class="s"> </span><span class="s">@</span><span class="s">theName</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">@</span><span class="s">name</span>
<span class="s">        </span><span class="s">select</span><span class="s"> </span><span class="s">&#39;</span><span class="s">hello&#39;</span><span class="s"> </span><span class="s">+</span><span class="s"> </span><span class="s">@</span><span class="s">theName</span><span class="s">,</span><span class="s"> </span><span class="s">&#39;</span><span class="s">your</span><span class="s"> </span><span class="s">name</span><span class="s"> </span><span class="s">is</span><span class="s"> </span><span class="s">:</span><span class="s">&#39;</span><span class="s"> </span><span class="s">+</span><span class="s"> </span><span class="s">@</span><span class="s">theName</span>
<span class="s">    </span><span class="s">&quot;</span>, <span class="i">connectionString</span>, <span class="i">ResultType</span><span class="o">.</span><span class="i">Tuples</span>, <span class="i">SingleRow</span> <span class="o">=</span> <span class="k">true</span><span class="o">&gt;</span>(<span class="i">connectionString</span>)</pre>
</td>
</tr>
</table>

<h3>5. Exposing types generated by SqlCommandProvider</h3>

<h3>6. Reusing typed record with a custom command</h3>

<p>With a datareader obtained from a custom command you can still reuse the typed record definition through the DynamicRecord class.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">Literal</span>&gt;]
<span class="k">let</span> <span class="i">getDatesQuery</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">SELECT</span><span class="s"> </span><span class="s">GETDATE</span><span class="s">(</span><span class="s">)</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">Now</span><span class="s">,</span><span class="s"> </span><span class="s">GETUTCDATE</span><span class="s">(</span><span class="s">)</span><span class="s"> </span><span class="s">AS</span><span class="s"> </span><span class="s">UtcNow</span><span class="s">&quot;</span>
<span class="k">type</span> <span class="i">GetDates</span> <span class="o">=</span> <span class="i">SqlCommandProvider</span><span class="o">&lt;</span><span class="i">getDatesQuery</span>,  <span class="i">connectionString</span><span class="o">&gt;</span>

<span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">SqlClient</span>
<span class="k">type</span> <span class="i">SqlDataReader</span> <span class="k">with</span>
    <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">ToRecords</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>() <span class="o">=</span> 
        <span class="i">seq</span> {
            <span class="k">while</span> <span class="i">this</span><span class="o">.</span><span class="i">Read</span>() <span class="k">do</span>
                <span class="k">let</span> <span class="i">data</span> <span class="o">=</span> 
                    <span class="i">dict</span> [ 
                        <span class="k">for</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span class="i">this</span><span class="o">.</span><span class="i">VisibleFieldCount</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span> 
                            <span class="k">yield</span> <span class="i">this</span><span class="o">.</span><span class="i">GetName</span>(<span class="i">i</span>), <span class="i">this</span><span class="o">.</span><span class="i">GetValue</span>(<span class="i">i</span>)
                    ]

                <span class="k">yield</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">SqlClient</span><span class="o">.</span><span class="i">DynamicRecord</span>(<span class="i">data</span>) <span class="o">|&gt;</span> <span class="i">box</span> <span class="o">|&gt;</span> <span class="i">unbox</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>
        }
    
<span class="k">let</span> <span class="i">xs</span> <span class="o">=</span> 
    <span class="k">use</span> <span class="i">conn</span> <span class="o">=</span> <span class="k">new</span> <span class="i">SqlConnection</span>(<span class="i">connectionString</span>)
    <span class="i">conn</span><span class="o">.</span><span class="i">Open</span>()
    <span class="k">let</span> <span class="i">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="i">System</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">SqlClient</span><span class="o">.</span><span class="i">SqlCommand</span>(<span class="i">getDatesQuery</span>, <span class="i">conn</span>)
    <span class="i">cmd</span><span class="o">.</span><span class="i">ExecuteReader</span>()<span class="o">.</span><span class="i">ToRecords</span><span class="o">&lt;</span><span class="i">GetDates</span><span class="o">.</span><span class="i">Record</span><span class="o">&gt;</span>() 
    <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">toArray</span></pre>
</td>
</tr>
</table>

<h3>7. Why do I sometimes get ExecuteSingle and AsyncExecuteSingle options with the SqlProgrammabilityProvider?</h3>

<p>There are two cases when you would get those extra methods.</p>

<ul>
<li>Referencing a stored procedure that returns some sort of result set you will get these extra methods.</li>
<li>Referencing a Table Valued Function</li>
</ul>

<p>In both cases the methods return <code>Option&lt;'T&gt;</code> (or <code>Async&lt;Option&lt;'T&gt;&gt;</code>) rather than <code>Seq&lt;'T&gt;</code> (or <code>Async&lt;Seq&lt;'T&gt;&gt;</code>)</p>


            </div>

            <div class="span3">
                <a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">
                    <img src="img/logo.png" style="width: 200px; height: 200px; margin: 10px 0px 0px 35px; border-style: none;" />
                </a>
                <ul class="nav nav-list" id="menu">
                    <li class="nav-header">F# SqlClient</li>
                    <li><a href="./index.html">Home page</a></li>
                    <li class="divider"></li>
                    <li><a href="http://www.nuget.org/packages/FSharp.Data.SqlClient">Get Library via NuGet</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient">Source Code on GitHub</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/LICENSE.md">License</a></li>
                    <li><a href="http://github.com/fsprojects/FSharp.Data.SqlClient/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

                    <li class="nav-header">Documentation</li>
                    <li><a href="./whatsnew.html">What's New</a></li>
                    <li><a href="./configuration and input.html">Configuration and Input</a></li>
                    <li><a href="./output.html">Output</a></li>
                    <li><a href="./faq.html">FAQ</a></li>
                    <li class="divider"></li>
                    <li><a href="./data modification.html">Data Modification</a></li>
                    <li><a href="./transactions.html">Transactions</a></li>
                    <li class="divider"></li>
                    <li><a href="./debugging.html">Debugging</a></li>
                    <li><a href="./unit-testing.html">Unit Testing</a></li>
                    <li class="divider"></li>
                    <li><a href="./comparison.html">Comparison</a></li>
                    <li><a href="./dynamic local db.html">Dynamic local db</a></li>
                    <li class="divider"></li>
                    <li><a href="./sqlenumprovider.quickstart.html">SqlEnumProvider</a></li>

                    <li class="nav-header">Tools</li>
                    <li><a href="http://tpetricek.github.io/FSharp.Formatting/">F# Formatting</a></li>
                    <li><a href="http://fsharp.github.io/FAKE/">FAKE</a></li>
                    <li><a href="http://fsprojects.github.io/ProjectScaffold/">F# open-source project scaffolding</a></li>
                    <li><a href="http://tomasp.net/blog/2013/great-open-source/index.html">Building great open-source libraries</a></li>
                </ul>
            </div>
        </div>
    </div>
    <a href="http://github.com/fsprojects/FSharp.Data.SqlClient">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub">
    </a>
</body>
</html>
